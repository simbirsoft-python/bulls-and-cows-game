# Описание

Web-приложение, реализующее игру "Быки и коровы"

## Разворачивание проекта

Для того, чтобы запустить данный проект, необходимо выполнить следующие шаги.


### Настройка переменных окружения

В данном приложении вся "чувствительная информация" хранится в переменных 
окружения. Поэтому, перед сборкой/запуском проекта необходимо создать файл 
`.env` (необходимо скопировать файл `.env.example`, назвать его `.env` и 
подставить в него нужные значения), который будет содержать все необходимые 
переменные окружения.


### Запуск проекта

После того, как `.env` файл с переменным окружения создан, можно приступать к
запуску проекта.


### Запуск в режиме разработки (внутри docker)

Для того, чтобы запустить проект в docker, достаточно выполнить в консоли
следующую команду:

```
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build
```

Она запустит проект в режиме разработки (внутрь контейнера будет примонтирована
папка с исходными кодами, это позволит работать с кодом локально, а приложение
внутри docker будет автоматически перезапускаться), а также запустит все 
необходимое (базу данных и т д).

После запуска приложение будет доступно по адресу http://0.0.0.0:5000/.

 
### Локальный запуск приложения

Если необходимо запустить приложение локально (например для дебага), необходимо:

- локально установить все необходимые для запуска приложения зависимости
  (описание установки зависимостей находится в `Инструкции -> Установка зависимостей`).

- запустить нужные для приложения сервисы в docker

    ```
    docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build -d && docker-compose stop app
    ```

- запустить само приложение

    ```
    python3 ./app.py
    ```


### Запуск проекта в продакшен

Для того, чтобы развернуть приложение в продакшен, необходимо выполнить:

```
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up --build -d
```


## Инструкции

### Установка зависимостей

Для запуска приложения вне docker контейнера необходимо установить:

- python3.7
- poetry


**Установка pyenv**

Для установки python удобно использовать pyenv (но вообще можно использовать 
любой удобный для вас способ). Если вы решили установить pyenv, то ниже будут 
представлены команды для установки нужной версии python. 

Для того, чтобы установить pyenv, можете воспользоваться одной из 
нижеперечисленных инструкций:

- [Оф. инструкция по установке](https://github.com/pyenv/pyenv)
- [Неплохая статья с описанием pyenv](https://khashtamov.com/ru/pyenv-python/)


**Установка poetry**

Также необходимо установить poetry (менеджер зависимостей, который 
установит все используемые в проекте библиотеки). Установить его вы можете по 
[инструкции](#Инструкция-по-установке-poetry).


После того, как pyenv и poetry установлены, можно приступать к установке python,
созданию виртуального окружения для проекта и установке зависимостей:

1. Откройте консоль и перейдите в корень проекта.

2. Установите нужную версию python при помощи команды:
 
    ```
    pyenv install 3.7.4
    ```
     
    Если вы установили python без помощи pyenv, замените шаги 2 и 3 выполнением 
    команды:
   
    ```
    python3 -m venv ./venv && source ./venv/bin/activate
    ```

3. Выполните команду:
 
    ```
    pyenv local 3.7.4
    ```
 
4. Выполните команду:
 
    ```
    poetry install
    ```
   
    Она автоматически создаст виртуальное окружение и установит туда все 
    необходимые зависимости (виртуальное окружение будет создано в 
    `~/.cache/pypoetry/virtualenvs`.


## Полезные команды

При работе с docker вам могут пригодиться следующие команды:

- `docker-compose ps` - выводит список запущенных контейнеров и отображает их статус
- `docker-compose logs` - выводит логи всех контейнеров
- `docker-compose logs -f` - выводит логи всех контейнеров в режиме реального времени
- `docker-compose stop` - останавливает все контейнеры
- `docker exec -i -t bulls-and-cows-game_app_1 /bin/bash` - выполняет 
  подключение к контейнеру `bulls-and-cows-game_app_1`


## Ссылки

Swagger UI доступен по адресу http://0.0.0.0:5000/swagger/ или 
http://0.0.0.0/swagger/

Административный интерфейс rabbitmq доступен по [адресу](http://localhost:15672) 
